# 打字动画

## 效果描述

打字动画模拟真实打字过程，文字逐个字符显现，通常伴随闪烁的光标

:::dom

```html
<div>hello world</div>
```

```css
@keyframes typing {
    from { width: 0; }
}
@keyframes caret { /* 闪烁动画 */
    50% { border-color: transparent; }
}

div {
    width: 11ch;
    overflow: hidden;
    white-space: nowrap;
    font-family: SimSun,Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace;
    border-right: 2px solid; /* 颜色随着字体颜色变化 */
    animation: typing 4s steps(11), caret 1s steps(1) infinite; /* 光标动画应该是无限执行的 */
}
```

:::

## 单行 + 等宽字体实现

把所有文本包裹在这个容器中，然后让它的宽度从 **0** 开始以步进动画的方式，一个字一个字地扩张到它应有的宽度

:::demo

```html
<div>hello world</div>
```

```css
@keyframes typing {
    from { width: 0; }
}

div {
    width: calc(1ch * var(--len)); /* len个字 */
    overflow: hidden; /* 剪切的方式 */
    white-space: nowrap; /* 不换行 */
    font-family: Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace; /* 等宽字体 */
    animation: typing 4s steps(var(--len)) infinite alternate;
}
```

```js
const div = document.querySelector('div')
const len = div.textContent.length
div.style.setProperty('--len', len)
```

:::

追加光标效果，用右边框模拟光标，并让其有闪烁效果

:::demo

```html
<div>hello world</div>
```

```css
@keyframes typing {
    from { width: 0; }
}
@keyframes caret { /* 闪烁动画 */
    50% { border-color: transparent; }
}

div {
    width: calc(1ch * var(--len)); /* len个字 */
    overflow: hidden;
    white-space: nowrap;
    font-family: Consolas,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New, monospace; /* 等宽字体 */
    border-right: 2px solid; /* 颜色随着字体颜色变化 */
    animation: typing 4s steps(var(--len)) infinite alternate, caret 1s steps(1) infinite; /* 光标动画应该是无限执行的 */
}
```

```js
const div = document.querySelector('div')
const len = div.textContent.length
div.style.setProperty('--len', len)
```

:::

## 非等宽字体 + 多行

CSS 负责光标动画，JS 负责每隔几十毫秒往 DOM 里塞一个字符

:::demo

```html
<div id="typewriter" class="typewriter-content"></div>
```

```css
.typewriter-content {
  line-height: 1.6;
  white-space: pre-wrap; /* 保留换行符，同时允许自动换行 */
}

/* 创建光标 */
.typewriter-content::after {
  content: '|';
  display: inline-block;
  vertical-align: baseline;
  animation: blink 1s step-end infinite;
  color: #333;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0; }
}
```

```js
class Typewriter {
  constructor(element, text, speed = 50) {
    this.element = element;
    this.text = text;
    this.speed = speed;
    this.index = 0;
  }

  type() {
    if (this.index < this.text.length) {
      // 追加字符
      this.element.textContent += this.text.charAt(this.index);
      this.index++;
      
      // 随机化一点时间，模拟真实打字的不规则感
      const randomSpeed = this.speed + (Math.random() * 50 - 25);
      
      setTimeout(() => this.type(), randomSpeed);
    }
  }
}

// 使用方式
const el = document.getElementById('typewriter');
const text = "Hello, 你好！\n欢迎来到kingmusi博客\n这是一个多行非等宽字体css动画的演示。";
const writer = new Typewriter(el, text, 100);
writer.type();
```

:::

