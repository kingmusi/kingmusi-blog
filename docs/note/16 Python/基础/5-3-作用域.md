# ä½œç”¨åŸŸ

## ğŸ¯ æ¦‚è¿°

ä½œç”¨åŸŸæ˜¯Pythonç¼–ç¨‹ä¸­çš„æ ¸å¿ƒæ¦‚å¿µï¼Œå®ƒå†³å®šäº†**å˜é‡åœ¨ç¨‹åºä¸­çš„å¯è§æ€§å’Œè®¿é—®æ€§**ã€‚ç†è§£ä½œç”¨åŸŸæœºåˆ¶å¯¹äºç¼–å†™é«˜è´¨é‡çš„Pythonä»£ç è‡³å…³é‡è¦ã€‚

## ğŸ“– 1. ä½œç”¨åŸŸ (Scope)

### ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸï¼Ÿ
ä½œç”¨åŸŸæ˜¯æŒ‡**å˜é‡åœ¨ä»£ç ä¸­å¯ä»¥è¢«è®¿é—®çš„åŒºåŸŸèŒƒå›´**ã€‚å˜é‡åªèƒ½åœ¨å…¶å®šä¹‰çš„ä½œç”¨åŸŸå†…è¢«è®¿é—®å’Œä¿®æ”¹ã€‚

### Pythonä¸­çš„å››ç§ä½œç”¨åŸŸ ğŸ”

Pythonéµå¾ª**LEGBè§„åˆ™**æ¥æŸ¥æ‰¾å˜é‡ï¼š

1. **L (Local)** - å±€éƒ¨ä½œç”¨åŸŸ
2. **E (Enclosing)** - åµŒå¥—ä½œç”¨åŸŸ
3. **G (Global)** - å…¨å±€ä½œç”¨åŸŸ
4. **B (Built-in)** - å†…ç½®ä½œç”¨åŸŸ

> `python` æ²¡æœ‰å…¶ä»–è¯­è¨€çš„å—çº§ä½œç”¨åŸŸï¼Œæ¯”å¦‚ `for` å¾ªç¯å†…ä¸ç®—ä½œç”¨åŸŸ

:::demo
```python
# å†…ç½®ä½œç”¨åŸŸ (Built-in)
print("Hello")  # printæ˜¯å†…ç½®å‡½æ•°

# å…¨å±€ä½œç”¨åŸŸ (Global)
global_var = "æˆ‘æ˜¯å…¨å±€å˜é‡"

def outer_function():
    # åµŒå¥—ä½œç”¨åŸŸ (Enclosing)
    enclosing_var = "æˆ‘æ˜¯åµŒå¥—å˜é‡"
    
    def inner_function():
        # å±€éƒ¨ä½œç”¨åŸŸ (Local)
        local_var = "æˆ‘æ˜¯å±€éƒ¨å˜é‡"
        print(f"å±€éƒ¨: {local_var}")
        print(f"åµŒå¥—: {enclosing_var}")
        print(f"å…¨å±€: {global_var}")
    
    return inner_function

# è°ƒç”¨ç¤ºä¾‹
func = outer_function()
func()
```
:::

> **æ³¨æ„**ï¼šå˜é‡æŸ¥æ‰¾é¡ºåºæ˜¯ä»å†…åˆ°å¤–ï¼Œå³ ==Local â†’ Enclosing â†’ Global â†’ Built-in==

## ğŸ”— 2. ä½œç”¨åŸŸé“¾ (Scope Chain)

### ä»€ä¹ˆæ˜¯ä½œç”¨åŸŸé“¾ï¼Ÿ
ä½œç”¨åŸŸé“¾æ˜¯æŒ‡**è§£é‡Šå™¨åœ¨æŸ¥æ‰¾å˜é‡æ—¶æ‰€éµå¾ªçš„æŸ¥æ‰¾è·¯å¾„**ã€‚å½“è®¿é—®ä¸€ä¸ªå˜é‡æ—¶ï¼ŒPythonä¼šæŒ‰ç…§LEGBçš„é¡ºåºé€å±‚å‘å¤–æŸ¥æ‰¾ã€‚

### ä½œç”¨åŸŸé“¾çš„å·¥ä½œåŸç†

:::demo
```python
x = "å…¨å±€x"  # å…¨å±€ä½œç”¨åŸŸ

def outer():
    x = "å¤–å±‚x"  # åµŒå¥—ä½œç”¨åŸŸ
    
    def middle():
        x = "ä¸­å±‚x"  # åµŒå¥—ä½œç”¨åŸŸ
        
        def inner():
            # æ²¡æœ‰å®šä¹‰xï¼Œä¼šå‘å¤–å±‚æŸ¥æ‰¾
            print(f"innerå‡½æ•°ä¸­çš„x: {x}")  # è¾“å‡º: ä¸­å±‚x
            
        def inner2():
            x = "å†…å±‚x"  # å±€éƒ¨ä½œç”¨åŸŸ
            print(f"inner2å‡½æ•°ä¸­çš„x: {x}")  # è¾“å‡º: å†…å±‚x
            
        inner()
        inner2()
    
    middle()

outer()
```
:::

### å®é™…åº”ç”¨ç¤ºä¾‹ ğŸ’¡

:::demo
```python
count = 0  # å…¨å±€å˜é‡

def create_counter():
    """åˆ›å»ºä¸€ä¸ªè®¡æ•°å™¨å‡½æ•°"""
    count = 0  # å±€éƒ¨å˜é‡ï¼Œä¸å…¨å±€å˜é‡åŒå
    
    def increment():
        nonlocal count  # å£°æ˜ä½¿ç”¨å¤–å±‚çš„count
        count += 1
        return count
    
    return increment

# ä½¿ç”¨ç¤ºä¾‹
counter1 = create_counter()
counter2 = create_counter()

print(counter1())  # è¾“å‡º: 1
print(counter1())  # è¾“å‡º: 2
print(counter2())  # è¾“å‡º: 1 (ç‹¬ç«‹çš„è®¡æ•°å™¨)
print(f"å…¨å±€count: {count}")  # è¾“å‡º: 0 (å…¨å±€å˜é‡æœªè¢«å½±å“)
```
:::

> **é‡è¦**ï¼šæ¯ä¸ªå‡½æ•°è°ƒç”¨éƒ½ä¼šåˆ›å»ºæ–°çš„å±€éƒ¨ä½œç”¨åŸŸï¼Œå³ä½¿æ˜¯åŒä¸€ä¸ªå‡½æ•°çš„å¤šæ¬¡è°ƒç”¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

## ğŸŒ 3. global å…³é”®å­—

> **é¿å…è¿‡åº¦ä½¿ç”¨global**ï¼šé¢‘ç¹ä½¿ç”¨globalä¼šä½¿ä»£ç éš¾ä»¥ç»´æŠ¤å’Œæµ‹è¯•ï¼Œåº”è¯¥å°½é‡é€šè¿‡å‡½æ•°å‚æ•°å’Œè¿”å›å€¼æ¥ä¼ é€’æ•°æ®ã€‚

### globalçš„ä½œç”¨
`global`å…³é”®å­—ç”¨äº**åœ¨å‡½æ•°å†…éƒ¨å£°æ˜å…¨å±€å˜é‡**ï¼Œä½¿å¾—å‡½æ•°å¯ä»¥ä¿®æ”¹å…¨å±€ä½œç”¨åŸŸä¸­çš„å˜é‡ã€‚

### åŸºæœ¬è¯­æ³•å’Œä½¿ç”¨

:::demo
```python
counter = 0  # å…¨å±€å˜é‡

def increment_global():
    global counter  # å£°æ˜ä½¿ç”¨å…¨å±€å˜é‡
    counter += 1
    print(f"è®¡æ•°å™¨å€¼: {counter}")

def increment_local():
    counter = 1  # åˆ›å»ºå±€éƒ¨å˜é‡ï¼Œä¸å½±å“å…¨å±€å˜é‡
    counter += 1
    print(f"å±€éƒ¨è®¡æ•°å™¨: {counter}")

# æµ‹è¯•å¯¹æ¯”
print(f"åˆå§‹å…¨å±€counter: {counter}")  # 0

increment_local()  # å±€éƒ¨è®¡æ•°å™¨: 2
print(f"è°ƒç”¨increment_localå: {counter}")  # 0 (æœªæ”¹å˜)

increment_global()  # è®¡æ•°å™¨å€¼: 1  
print(f"è°ƒç”¨increment_globalå: {counter}")  # 1 (å·²æ”¹å˜)
```
:::

### globalçš„å¸¸è§åº”ç”¨åœºæ™¯ ğŸª

#### 1. é…ç½®ç®¡ç†

:::demo
```python
# å…¨å±€é…ç½®
DEBUG = False
API_URL = "https://api.example.com"

def set_debug_mode(enabled):
    global DEBUG
    DEBUG = enabled
    print(f"è°ƒè¯•æ¨¡å¼: {'å¼€å¯' if DEBUG else 'å…³é—­'}")

def set_api_url(url):
    global API_URL
    API_URL = url
    print(f"APIåœ°å€æ›´æ–°ä¸º: {API_URL}")

# ä½¿ç”¨ç¤ºä¾‹
set_debug_mode(True)
set_api_url("https://test-api.example.com")
```
:::

#### 2. çŠ¶æ€ç®¡ç†

:::demo
```python
# æ¸¸æˆçŠ¶æ€ç®¡ç†
game_score = 0
game_level = 1

def update_score(points):
    global game_score, game_level
    game_score += points
    
    # æ¯1000åˆ†å‡ä¸€çº§
    if game_score >= game_level * 1000:
        game_level += 1
        print(f"ğŸ‰ æ­å–œå‡çº§åˆ°ç¬¬{game_level}çº§!")

def reset_game():
    global game_score, game_level
    game_score = 0
    game_level = 1
    print("ğŸ”„ æ¸¸æˆé‡ç½®å®Œæˆ")

# ä½¿ç”¨ç¤ºä¾‹
update_score(500)   # å¾—åˆ†: 500
update_score(600)   # ğŸ‰ æ­å–œå‡çº§åˆ°ç¬¬2çº§!
print(f"å½“å‰çŠ¶æ€ - åˆ†æ•°: {game_score}, ç­‰çº§: {game_level}")
```
:::
