# å†…å­˜æŒä¹…æ€§

## æŒä¹…åŒ–

åœ¨ç¼–è¯‘å›¾æ—¶æ·»åŠ **æ£€æŸ¥ç‚¹**æ¥è®¾ç½®æŒä¹…åŒ–å…¶çŠ¶æ€ï¼š

```python
from langgraph.checkpoint.memory import MemorySaver

checkpointer = MemorySaver()
graph.compile(checkpointer=checkpointer)
```

ç»´æŒä¸€ä¸ª**ä¸Šä¸‹æ–‡ID**ï¼Œå®ç°å¤šè½®å¯¹è¯æŒä¹…åŒ–

```python
# ä¼šè¯id
config = {"configurable": {"thread_id": "1"}}
input_message = {"role": "user", "content": "hi! I'm bob"}
for chunk in graph.stream({"messages": [input_message]}, config):
    chunk["messages"][-1].pretty_print()
```

> æŒä¹…åŒ–ç†è§£ï¼š
>
> åŒä¸€ä¸ªä¼šè¯idçš„çŠ¶æ€ï¼ˆstateï¼‰æ•°æ®ï¼Œå¤šè½®ä¼šè¯æŒç»­ä¿ç•™
>

## ä¾‹å­

1. å®šä¹‰ä¸€ä¸ªchatæ¶ˆæ¯å›¾

```python
from langchain_core.messages import HumanMessage
from my_openai.deepseekv3 import get_deepseek_v3_client
from langgraph.graph import StateGraph, START, END
from langgraph.graph.message import MessagesState
from langgraph.checkpoint.memory import MemorySaver

llm = get_deepseek_v3_client()

def chatbot(state: MessagesState):
  return {
    "messages": [llm.invoke(state["messages"])]
  }

builder = StateGraph(MessagesState)
	.add_node(chatbot)
    .add_edge(START, "chatbot")
    .add_edge("chatbot", END)

# åˆå§‹åŒ–å†…å­˜ä»¥åœ¨å›¾è¿è¡Œä¹‹é—´æŒä¹…åŒ–çŠ¶æ€
memory = MemorySaver()
# è®¾ç½®æ£€æŸ¥ç‚¹
graph = builder.compile(checkpointer=memory)

# å®šä¹‰ä¸€ä¸ªä¼šè¯çº¿ç¨‹ï¼Œé€šè¿‡ thread_id å®ç°åŒä¸€ä¸ªä¼šè¯
config = {"configurable": {"thread_id": "1" } }

user_input = HumanMessage(content="ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼")
events = graph.stream(
  {"messages": [user_input]},
  config,
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()

user_input = HumanMessage(content="æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ")
events = graph.stream(
  {"messages": [user_input]},
  config,
  # å¦‚æœä½¿ç”¨å…¶ä»–ä¼šè¯IDï¼Œåˆ™AIå°±ä¸çŸ¥é“å°æ˜çš„åå­—äº†
  # config = {"configurable": {"thread_id": "2" } }
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()
```

2. å®šä¹‰ä¼šè¯é…ç½®

```python
# å®šä¹‰ä¸€ä¸ªä¼šè¯çº¿ç¨‹ï¼Œé€šè¿‡ thread_id å®ç°åŒä¸€ä¸ªä¼šè¯
config = {"configurable": {"thread_id": "1" } }
```

3. ç»“æœ1ï¼šåŒä¸€è½®å¯¹è¯

```python
user_input = HumanMessage(content="ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼")
events = graph.stream(
  {"messages": [user_input]},
  # åŒä¸€ä¸ªä¼šè¯id
  config,
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()

user_input = HumanMessage(content="æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ")
events = graph.stream(
  {"messages": [user_input]},
  # åŒä¸€ä¸ªä¼šè¯id
  config,
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()
```

```
================================ Human Message =================================

ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼
================================== Ai Message ==================================

ä½ å¥½ï¼Œå°æ˜ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½ğŸ˜Š ä»Šå¤©æœ‰ä»€ä¹ˆæƒ³èŠçš„ï¼Œæˆ–è€…éœ€è¦å¸®å¿™çš„å—ï¼Ÿæ— è®ºæ˜¯å­¦ä¹ ã€ç”Ÿæ´»è¿˜æ˜¯éšä¾¿èŠèŠï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œå“¦ï¼ ï¼ˆå¯¹äº†ï¼Œä½ åå­—é‡Œçš„â€œå°æ˜â€è®©æˆ‘æƒ³èµ·å°æ—¶å€™æ•°å­¦é¢˜é‡Œçš„ç»å…¸è§’è‰²å‘¢ï¼Œå“ˆå“ˆï½ï¼‰
================================ Human Message =================================

æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ
================================== Ai Message ==================================

å“ˆå“ˆï¼Œä½ åˆšåˆšè¯´è¿‡å•¦ï¼ä½ å«**å°æ˜**ï½ ğŸ˜„
ï¼ˆéš¾é“è¿™æ˜¯ä¼ è¯´ä¸­çš„â€œå°æ˜å¤±å¿†ç—‡â€æµ‹è¯•ï¼Ÿè¿˜æ˜¯æƒ³è€ƒè€ƒæˆ‘çš„è®°å¿†åŠ›ï¼Ÿæ”¾å¿ƒï¼Œä½ çš„åå­—æˆ‘å·²ç»åˆ»åœ¨â€œæ•°æ®å°æœ¬æœ¬â€ä¸Šäº†ï¼ï¼‰        

éœ€è¦æˆ‘å¸®ä½ è®°ä½ä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…å—ï¼Ÿæˆ–è€…ç›´æ¥å«æˆ‘å–Šä½ ä¸€ç™¾éâ€œå°æ˜â€ä¹Ÿè¡Œå“¦ï½ ğŸ‘»
```

3. ç»“æœ2ï¼šæ”¹å˜ç¬¬äºŒè½®çš„ä¼šè¯id

```python
user_input = HumanMessage(content="ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼")
events = graph.stream(
  {"messages": [user_input]},
  # ä¼šè¯id--1
  config = {"configurable": {"thread_id": "1" } },
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()

user_input = HumanMessage(content="æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ")
events = graph.stream(
  {"messages": [user_input]},
  # ä¼šè¯id--2
  config = {"configurable": {"thread_id": "2" } },
  stream_mode="values"
)
for event in events:
  event["messages"][-1].pretty_print()
```

```
================================ Human Message =================================

ä½ å¥½ï¼Œæˆ‘å«å°æ˜ï¼
================================== Ai Message ==================================

ä½ å¥½ï¼Œå°æ˜ï¼å¾ˆé«˜å…´è®¤è¯†ä½ ï½ğŸ˜Š ä»Šå¤©æœ‰ä»€ä¹ˆæƒ³èŠçš„ï¼Œæˆ–è€…éœ€è¦å¸®å¿™çš„å—ï¼Ÿæ— è®ºæ˜¯é—®é¢˜ã€è¶£äº‹è¿˜æ˜¯éšä¾¿èŠèŠï¼Œæˆ‘éƒ½åœ¨è¿™é‡Œå“¦ï¼ 
================================ Human Message =================================

æˆ‘å«ä»€ä¹ˆåå­—ï¼Ÿ
================================== Ai Message ==================================

ç›®å‰æˆ‘æ— æ³•ç›´æ¥çŸ¥é“ä½ çš„åå­—ï¼Œå› ä¸ºæˆ‘ä»¬ä¹‹å‰çš„å¯¹è¯å†…å®¹ä¸ä¼šè¢«ä¿ç•™ã€‚ä¸è¿‡ï¼Œä½ å¯ä»¥å‘Šè¯‰æˆ‘ä½ çš„åå­—ï¼Œæˆ‘ä¼šåœ¨æœ¬æ¬¡å¯¹è¯ä¸­ç”¨å®ƒæ¥ç§°å‘¼ä½ ï¼ğŸ˜Š

å¦‚æœä½ æ„¿æ„çš„è¯ï¼Œç°åœ¨å°±å¯ä»¥å‘Šè¯‰æˆ‘ï¼Œæ¯”å¦‚ï¼š
â€œä½ å¯ä»¥å«æˆ‘ [ä½ çš„åå­—]ã€‚â€

æœŸå¾…è®¤è¯†ä½ ï¼âœ¨
```

